
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://michael-adcock.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://michael-adcock.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://michael-adcock.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://michael-adcock.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Michael Adcock Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Michael Adcock" />
<meta name="description" content="An Area Classification of Consumer Vulnerability in the UK using 2011 census data" />
<meta name="keywords" content="R, k-means, principal component analysis, PCA, census, consumer vulnerability">
<meta property="og:site_name" content="Michael Adcock"/>
<meta property="og:title" content="An Area Classification of Consumer Vulnerability in the UK"/>
<meta property="og:description" content="An Area Classification of Consumer Vulnerability in the UK using 2011 census data"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://michael-adcock.github.io/consumer_vulnerability.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-05-26 20:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://michael-adcock.github.io/author/michael-adcock.html">
<meta property="article:section" content="posts"/>
<meta property="article:tag" content="R"/>
<meta property="article:tag" content="k-means"/>
<meta property="article:tag" content="principal component analysis"/>
<meta property="article:tag" content="PCA"/>
<meta property="article:tag" content="census"/>
<meta property="article:tag" content="consumer vulnerability"/>
<meta property="og:image" content="">

  <title>Michael Adcock &ndash; An Area Classification of Consumer Vulnerability in the UK</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://michael-adcock.github.io">
        <img src="https://michael-adcock.github.io/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="https://michael-adcock.github.io"></a></h1>

<p>Data Scientist</p>

      <ul class="social">
        <li><a class="sc-github" href="https://github.com/michael-adcock" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/m-t-adcock/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
    <h1 id="consumer_vulnerability">An Area Classification of Consumer Vulnerability in the UK</h1>
    <p>
          Posted on Sat 26 May 2018 in <a href="https://michael-adcock.github.io/category/posts.html">posts</a>


    </p>
  </header>


  <div>
    <hr />
<p>title: "Consumer Vulnerability in the United Kingdom"
output: html_notebook</p>
<hr />
<h5>Michael Adcock</h5>
<p>\newline</p>
<h3>Abstract</h3>
<p>Consumer vulnerability has recently attracted increased media attention
due to a number of high profle cases. While consumer vulnerability has been
discussed at length for over a decade and guidelines have been produced, there
has not been a comprehensive geographical assessment of consumer vulnerabil-
ity in the United Kingdom. This work creates a geodemographic classifcation
of consumer vulnerability at the geography of output area. This classifcation
was achieved using a k-means approach. There were found to be six distinct
clusters of varying levels of vulnerability. Two clusters in particular can be
considered to contain high levels of vulnerable people, identifed as Vulner-
able Communities and Vulnerable Pensioners. To aid interpretability of the
results, pen portraits are provided for each cluster along with an interactive
map showing cluster assignment for every output area in the United Kingdom.
To further explore the characteristics of the clusters, sub-cluster were created
by using the same k-means methods on each individual cluster dataset. Com-
parison of these clusters and sub-clusters created with open source data to
closed sourced data obtained from a commercial partner also helped to fur-
ther explore the character of clusters. Comparison with a previous successful
geodemographic classification shows improvement in cluster tightness.</p>
<h3>A Definition of Consumer Vulnerability</h3>
<p>There is general agreement in the current literature that consumer vulnerably is highly complex and may be influenced by many factors. As such a definition used for categorising vulnerability should reflect this while still providing a useful measure. A suitable way of defining vulnerability would therefore be using a multidimensional approach.</p>
<p>To take these factors into account and produce a definition of consumer vulnerability that can be measured for this study, the following definition is proposed:</p>
<p><strong>Consumer vulnerability is the risk that a consumer's mental, physical or financial welfare may be damaged when engaging in a market interaction.</strong></p>
<p>This definition can be measured using five dimensions (based on the EC report):</p>
<p>1.Risk of harm occurring to the consumer as a result of a negative transaction outcome.</p>
<p>2.The ability of the consumer to maximise their own well-being.</p>
<p>3.The ability of the consumer to access suitable information about products or services.</p>
<p>4.The ability of the consumer to access suitable products and services.</p>
<p>5.Susceptibility of the consumer to market practices.</p>
<p>When making use of these dimensions to measure vulnerability the following factors should be considered: individual characteristics (e.g. age, income), transient states of the consumer (e.g. illness), external conditions (e.g. prejudice) on the consumer, and market forces acting on the consumer.</p>
<p>These five dimensions can be used to construct a scale of vulnerability (e.g. 1 to 5) as related to the above definition. This scale does not give an absolute measure of vulnerability of the consumer in every interaction but rather the risk that the consumer may be vulnerable in a given interaction.</p>
<p>This definition and the five dimensions of vulnerability can be considered from the perspective of different markets (e.g. energy sector, financial sector and the gambling industry) which will change the vulnerability scores of customers in respect to these markets.</p>
<h2>Methods</h2>
<p>Libraries and functions requied for analysis</p>
<div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span>plyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>RColorBrewer<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>tidyverse<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>rgdal<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>parallel<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>plotrix<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>reshape2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>sf<span class="p">)</span>

<span class="c1"># Subset OA data and calculate percentages using demominators </span>
count_to_percentage <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>input_df<span class="p">,</span> variable_choices<span class="p">)</span> <span class="p">{</span>
  tibble<span class="o">::</span>as.tibble<span class="p">(</span>input_df<span class="p">[</span>variable_choices<span class="o">$</span>VariableCode<span class="p">]</span> <span class="o">/</span> 
                      input_df<span class="p">[</span>variable_choices<span class="o">$</span>StatisticalUnit<span class="p">]</span> <span class="o">*</span> <span class="m">100</span><span class="p">)</span>
<span class="p">}</span>

ihs <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>input_df<span class="p">)</span> <span class="p">{</span>
  as.tibble<span class="p">(</span><span class="kp">log</span><span class="p">(</span>input_df <span class="o">+</span> <span class="kp">sqrt</span><span class="p">(</span>input_df <span class="o">^</span> <span class="m">2</span> <span class="o">+</span> <span class="m">1</span><span class="p">)))</span>
<span class="p">}</span>

z_scores <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>input_df<span class="p">)</span> <span class="p">{</span>
  <span class="c1"># Compute the column-wise means for all observations</span>
  mean_by_col <span class="o">&lt;-</span> <span class="kp">apply</span><span class="p">(</span>input_df<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kp">mean</span><span class="p">)</span>
  <span class="c1"># Compute the column-wise sample sd&#39;s for *all* observations</span>
  sd_by_col <span class="o">&lt;-</span> <span class="kp">apply</span><span class="p">(</span>input_df<span class="p">,</span> <span class="m">2</span><span class="p">,</span> sd<span class="p">)</span>
  <span class="c1"># Create the z-scores via the &#39;scale&#39; function</span>
  zscores <span class="o">&lt;-</span><span class="kp">scale</span><span class="p">(</span>input_df<span class="p">,</span> center <span class="o">=</span> mean_by_col<span class="p">,</span> scale <span class="o">=</span> sd_by_col<span class="p">)</span>
  as.tibble<span class="p">(</span>zscores<span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Corrolation</span>
cor_cutoff <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>variable<span class="p">,</span> cutoff<span class="p">)</span> <span class="p">{</span>
  cor_mat<span class="p">[,</span>variable<span class="p">][</span>cor_mat<span class="p">[,</span>variable<span class="p">]</span> <span class="o">&gt;=</span> cutoff <span class="o">|</span> cor_mat<span class="p">[,</span>variable<span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span>cutoff<span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Wrapper for kmeans</span>
k_means <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>k<span class="p">,</span> input_data<span class="p">,</span> n_start_input<span class="p">)</span> <span class="p">{</span>
  <span class="kp">set.seed</span><span class="p">(</span><span class="m">2494</span><span class="p">)</span>
  kmeans<span class="p">(</span>input_data<span class="p">,</span> 
         k<span class="p">,</span> iter.max <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> 
         nstart <span class="o">=</span> n_start_input<span class="p">,</span> 
         algorithm <span class="o">=</span> <span class="s">&quot;Lloyd&quot;</span><span class="p">)}</span>

k_comparison <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>input_data<span class="p">,</span> iter<span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">15</span><span class="p">,</span> n_start<span class="o">=</span><span class="m">25</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># Set up parrallel processing for windows</span>
  cl <span class="o">&lt;-</span> makeCluster<span class="p">(</span>detectCores<span class="p">()</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span>
  clusterExport<span class="p">(</span>cl<span class="o">=</span>cl<span class="p">,</span>
                varlist<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;iter&quot;</span><span class="p">,</span> <span class="s">&quot;k_means&quot;</span><span class="p">,</span> <span class="s">&quot;input_data&quot;</span><span class="p">,</span> <span class="s">&quot;n_start&quot;</span><span class="p">),</span>
                envir<span class="o">=</span><span class="kp">environment</span><span class="p">())</span>
  <span class="kp">system.time</span><span class="p">(</span>
    k_choice_clust_list <span class="o">&lt;-</span> parLapply<span class="p">(</span>cl<span class="p">,</span> iter<span class="p">,</span> k_means<span class="p">,</span> input_data<span class="p">,</span> n_start<span class="p">)</span>
  <span class="p">)</span>
  stopCluster<span class="p">(</span>cl<span class="p">)</span>
  <span class="kr">return</span><span class="p">(</span>k_choice_clust_list<span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Scree plot</span>
scree <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>k_choice_clust_list<span class="p">,</span> iter<span class="p">,</span> title<span class="p">)</span> <span class="p">{</span>
  wss <span class="o">&lt;-</span> purrr<span class="o">::</span>map<span class="p">(</span>k_choice_clust_list<span class="p">,</span> <span class="o">~</span><span class="m">.</span><span class="o">$</span>tot.withinss<span class="p">)</span>
  plot<span class="p">(</span>iter<span class="p">,</span> wss<span class="p">,</span> 
       type <span class="o">=</span> <span class="s">&quot;o&quot;</span><span class="p">,</span> 
       main <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Cluster Scree Plot: &quot;</span><span class="p">,</span> title<span class="p">),</span>
       xlab <span class="o">=</span> <span class="s">&quot;Number of Clusters&quot;</span><span class="p">,</span> 
       ylab <span class="o">=</span> <span class="s">&quot;Within Cluster Sum of Squares&quot;</span><span class="p">)</span>

  min_clus <span class="o">&lt;-</span>purrr<span class="o">::</span>map<span class="p">(</span>k_choice_clust_list<span class="p">,</span> <span class="o">~</span><span class="kp">min</span><span class="p">(</span><span class="m">.</span><span class="o">$</span>size<span class="p">))</span>
  plot<span class="p">(</span>iter<span class="p">,</span> min_clus<span class="p">,</span> 
       type <span class="o">=</span> <span class="s">&quot;h&quot;</span><span class="p">,</span> 
       main <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Smallest Cluster Plot:&quot;</span><span class="p">,</span> title<span class="p">),</span>
       xlab <span class="o">=</span> <span class="s">&quot;Number of Clusters&quot;</span><span class="p">,</span> 
       ylab <span class="o">=</span> <span class="s">&quot;Smallest Cluster Size&quot;</span><span class="p">)</span>
<span class="p">}</span>

run_kmeans_comp_subgroup <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>subgroup<span class="p">,</span> data<span class="p">,</span> num_pc<span class="p">)</span> <span class="p">{</span>
  data <span class="o">%&gt;%</span>
    filter<span class="p">(</span>cluster<span class="o">==</span>subgroup<span class="p">)</span> <span class="o">%&gt;%</span> 
    select<span class="p">(</span><span class="m">1</span><span class="o">:</span>num_pc<span class="p">)</span> <span class="o">%&gt;%</span> 
    k_comparison<span class="p">(</span>iter<span class="p">)</span> <span class="o">%&gt;%</span> 
    scree<span class="p">(</span>iter<span class="p">,</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;subgroup &quot;</span><span class="p">,</span> subgroup<span class="p">))</span>
<span class="p">}</span>

run_kmeans_subgroup <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>subgroup<span class="p">,</span> k<span class="p">,</span> nstart<span class="p">)</span> <span class="p">{</span>
  subgroup <span class="o">&lt;-</span> subgroup<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="kp">ncol</span><span class="p">(</span>subgroup<span class="p">)</span><span class="m">-1</span><span class="p">]</span>
  k_means<span class="p">(</span>k<span class="p">,</span> subgroup<span class="p">,</span> nstart<span class="p">)</span>
<span class="p">}</span>

avg_z <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>cluster_choice<span class="p">,</span> sub_kmeans_obj<span class="p">,</span> k_means_obj<span class="p">,</span> cv_ihs_z<span class="p">)</span> <span class="p">{</span>
  a <span class="o">&lt;-</span> as_tibble<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>cv_ihs_z<span class="p">,</span> cluster<span class="o">=</span>k_means_obj<span class="o">$</span>cluster<span class="p">))</span>
  a <span class="o">&lt;-</span> filter<span class="p">(</span>a<span class="p">,</span> cluster<span class="o">==</span>cluster_choice<span class="p">)[,</span> <span class="o">-</span><span class="kp">length</span><span class="p">(</span>a<span class="p">)]</span>
  ddply<span class="p">(</span>a<span class="p">,</span> <span class="m">.</span><span class="p">(</span>sub_kmeans_obj<span class="p">[[</span>cluster_choice<span class="p">]]</span><span class="o">$</span>cluster<span class="p">),</span> numcolwise<span class="p">(</span><span class="kp">mean</span><span class="p">))[,</span> <span class="m">-1</span><span class="p">]</span>
<span class="p">}</span>

cluster_difference <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>sub_cluster_zscores<span class="p">,</span> cluster_zscores<span class="p">)</span> <span class="p">{</span>
  cluster_zscores <span class="o">&lt;-</span> <span class="kp">unlist</span><span class="p">(</span>cluster_zscores<span class="p">)</span>
  sub_cluster_zscores <span class="o">-</span> cluster_zscores<span class="p">[</span><span class="kp">col</span><span class="p">(</span>sub_cluster_zscores<span class="p">)]</span> <span class="c1"># -</span>
<span class="p">}</span>

rename_rows <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> name<span class="p">)</span> <span class="p">{</span>
  <span class="kp">row.names</span><span class="p">(</span>df<span class="p">)</span> <span class="o">&lt;-</span> map<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>df<span class="p">),</span> <span class="kr">function</span><span class="p">(</span><span class="kp">row</span><span class="p">,</span> name<span class="p">)</span> <span class="kp">paste</span><span class="p">(</span>name<span class="p">,</span> <span class="s">&quot;: Subgroup &quot;</span><span class="p">,</span> <span class="kp">row</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> name<span class="p">)</span>
  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>
<span class="p">}</span>

create_heatmap <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>mean_cluster_zscores<span class="p">,</span> num_clusters<span class="p">,</span> margins<span class="p">)</span> <span class="p">{</span>
  <span class="c1"># Create heatmap</span>
  colours <span class="o">&lt;-</span> <span class="kp">rev</span><span class="p">(</span>brewer.pal<span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="s">&#39;BrBG&#39;</span><span class="p">))</span> <span class="c1"># reverse colours</span>
  break_nums <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">-1e10</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="m">-1.5</span><span class="p">,</span><span class="m">-1</span><span class="p">,</span><span class="m">-0.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1.5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">+1e10</span><span class="p">)</span> 
  legend_names <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;&lt;-2&quot;</span><span class="p">,</span><span class="s">&quot;-2 to -1.5&quot;</span><span class="p">,</span><span class="s">&quot;-1.5 to -1&quot;</span><span class="p">,</span><span class="s">&quot;-1 to -0.5&quot;</span><span class="p">,</span><span class="s">&quot;-0.5 to 0&quot;</span><span class="p">,</span><span class="s">&quot;0 to 0.5&quot;</span><span class="p">,</span><span class="s">&quot;1 to 2&quot;</span><span class="p">,</span><span class="s">&quot;1.5 to 2&quot;</span><span class="p">,</span><span class="s">&quot;2 to 2.5&quot;</span><span class="p">,</span><span class="s">&quot;&gt;2&quot;</span><span class="p">)</span>
  heatmap<span class="p">(</span><span class="kp">t</span><span class="p">(</span>mean_cluster_zscores<span class="p">),</span>
          scale <span class="o">=</span> <span class="s">&#39;none&#39;</span><span class="p">,</span>
          col <span class="o">=</span> colours<span class="p">,</span>

          breaks <span class="o">=</span> break_nums<span class="p">,</span> <span class="c1">#3</span>
          cexRow <span class="o">=</span> <span class="m">.5</span><span class="p">,</span>
          cexCol <span class="o">=</span> <span class="m">.8</span><span class="p">,</span>
          mar<span class="o">=</span>margins<span class="p">,</span>
          add.expr<span class="o">=</span> abline<span class="p">(</span>h <span class="o">=</span> <span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>mean_cluster_zscores<span class="p">))</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> v <span class="o">=</span> <span class="p">(</span><span class="m">0</span><span class="o">:</span>num_clusters<span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> col <span class="o">=</span> <span class="s">&#39;white&#39;</span><span class="p">))</span>
  par<span class="p">(</span>xpd<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> 
  legend<span class="p">(</span>title<span class="o">=</span><span class="kp">expression</span><span class="p">(</span>bold<span class="p">(</span><span class="s">&quot;z-score\n\n&quot;</span><span class="p">)),</span> <span class="m">0.22</span><span class="p">,</span> <span class="m">-0.07</span><span class="p">,</span> legend_names<span class="p">,</span> title.adj<span class="o">=</span><span class="m">0.48</span><span class="p">,</span> lty <span class="o">=</span> <span class="m">1</span><span class="p">,</span> lwd <span class="o">=</span> <span class="m">20</span><span class="p">,</span> col<span class="o">=</span>colours<span class="p">,</span> cex<span class="o">=</span><span class="m">0.7</span><span class="p">,</span> bty <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">,</span> horiz<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> adj<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="m">-2</span><span class="p">),</span> x.intersp<span class="o">=</span><span class="m">-1</span><span class="p">)</span>
  par<span class="p">(</span>xpd<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> 
 <span class="p">}</span>

<span class="c1"># produce radial plots</span>
radial_plot <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">,</span> main_title<span class="p">,</span> min_max<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">3</span><span class="p">),</span> legend_names<span class="p">)</span> <span class="p">{</span>
  <span class="kp">print</span><span class="p">(</span>main_title<span class="p">)</span>
  par<span class="p">(</span>cex.axis<span class="o">=</span><span class="m">.7</span><span class="p">)</span>
  par<span class="p">(</span>cex.lab<span class="o">=</span><span class="m">.6</span><span class="p">)</span>
  colours <span class="o">&lt;-</span> brewer.pal<span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="s">&#39;Set1&#39;</span><span class="p">)</span>
  p <span class="o">&lt;-</span> radial.plot<span class="p">(</span>data<span class="p">,</span> labels<span class="o">=</span><span class="kp">names</span><span class="p">(</span>data<span class="p">),</span>
              start<span class="o">=</span><span class="m">5</span><span class="p">,</span>
              clockwise<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>
              rp.type<span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">,</span>
              line.col<span class="o">=</span>colours<span class="p">,</span>
              lwd<span class="o">=</span><span class="m">1</span><span class="p">,</span>
              point.col<span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> 
              label.prop<span class="o">=</span><span class="m">0.91</span><span class="p">,</span>
              radlab<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>
              radial.lim <span class="o">=</span> min_max<span class="p">,</span>
              grid.col <span class="o">=</span> <span class="s">&quot;#E0E0E0&quot;</span><span class="p">,</span>
              col.sub <span class="o">=</span> <span class="s">&quot;green&quot;</span><span class="p">,</span>
              mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
              show.radial.grid<span class="o">=</span><span class="kc">TRUE</span>

  <span class="p">)</span>
  title<span class="p">(</span><span class="kp">paste</span><span class="p">(</span>main_title<span class="p">,</span> <span class="s">&quot;\n\n&quot;</span><span class="p">))</span>
  par<span class="p">(</span>xpd<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> 
  legend<span class="p">(</span><span class="m">9.5</span><span class="p">,</span><span class="m">-10</span><span class="p">,</span>legend_names<span class="p">,</span>lty<span class="o">=</span><span class="m">1</span><span class="p">,</span>lwd<span class="o">=</span><span class="m">1</span><span class="p">,</span>col<span class="o">=</span>colours<span class="p">,</span> cex<span class="o">=</span><span class="m">0.7</span><span class="p">,</span> bty <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">)</span>
  par<span class="p">(</span>xpd<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> 
<span class="p">}</span>

cluster_tibble <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>subgroup<span class="p">,</span> kmeans_obj<span class="p">,</span> cluster_name<span class="p">)</span> <span class="p">{</span>
  tib <span class="o">&lt;-</span> tibble<span class="p">(</span>subgroup<span class="o">$</span>OA<span class="p">,</span> kmeans_obj<span class="o">$</span>cluster<span class="p">)</span>
  <span class="kp">names</span><span class="p">(</span>tib<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;OA_SA&quot;</span><span class="p">,</span> cluster_name<span class="p">)</span> 
  <span class="kr">return</span><span class="p">(</span>tib<span class="p">)</span>
<span class="p">}</span>
</pre></div>


<h3>Acquisition of data</h3>
<p>The raw data used for this study was the UK Census from 2011. The file from which this data is taken is the input data from Output Area Classification (OAC) 2011. This file includes all variables (167 in total) prior to variable selection for OAC. The geographical units used are output areas and the data is structured in the form of counts for each variable per output area (except in certain specified cases where rates are used). The dataset and lookup table was downloaded from http://geogale.github.io/2011OAC found in the "Input Data" section under the title "2011 OAC 167 Initial Variables Dataset".</p>
<h3>Variable selection</h3>
<p>The initial variable selection was made from the 167 variables found in the 2011 census data as described above.  The selection was carried out using the definition of consumer vulnerably given above in this work (section 1.1.3). This was achieved by choosing variables from the pool of raw variables based on whether they describe one of the five dimensions of vulnerability. A .csv file was created containing the variable choices made on this basis, documenting the dimension of vulnerability to which each variable belonged.  </p>
<p>Variables were pooled when they were found to be no more informative when considered separately, from a consumer vulnerability perspective, than they were  when considered together.  For example, for the purpose of consumer vulnerability, married people with children, are functionally the same as cohabiting people with children so these variables were pooled into a single variable. This step helped to improve final interpretability of the clusters.</p>
<div class="highlight"><pre><span></span><span class="c1"># Load data</span>
oa_data <span class="o">&lt;-</span> readr<span class="o">::</span>read_csv<span class="p">(</span><span class="s">&quot;2011_OAC_Raw_uVariables.csv&quot;</span><span class="p">)</span>
variable_choices <span class="o">&lt;-</span> readr<span class="o">::</span>read_csv<span class="p">(</span><span class="s">&quot;K-means_version_5_variables.csv&quot;</span><span class="p">)</span>
lookup_table <span class="o">&lt;-</span> readr<span class="o">::</span>read_csv<span class="p">(</span><span class="s">&quot;2011_OAC_Raw_uVariables_Lookup.csv&quot;</span><span class="p">)</span>
</pre></div>


<h3>Data Treatment</h3>
<h4>Counts to Percentages</h4>
<p>In order to use the selected data for clustering, counts were converted to percentages for each output area. In order to correctly find the percentage for each variable the correct denominator needed to be identified (e.g. total population, population over 16) for the percentage calculation. The denominator for each variable to correctly calculate the percentage was documented in the variable choice .csv file. In the cases of a variable describing a rate rather than a count, the rate measure was kept as is.</p>
<div class="highlight"><pre><span></span><span class="c1"># Prepare raw data to pecentages</span>
cv_pct_data <span class="o">&lt;-</span> oa_data <span class="o">%&gt;%</span>
  tibble<span class="o">::</span>add_column<span class="p">(</span><span class="s">&quot;Rate&quot;</span> <span class="o">=</span> <span class="m">100</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Add a column of just 100&#39;s for use in percentage calcs below when already dealing with rates</span>
  count_to_percentage<span class="p">(</span>variable_choices<span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># Create percentages</span>
  base<span class="o">::</span><span class="kp">replace</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span><span class="m">.</span><span class="p">),</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Replace any nan&#39;s with 0&#39;s </span>
  dplyr<span class="o">::</span>mutate<span class="p">(</span>u062_u065 <span class="o">=</span> u062 <span class="o">+</span> u065<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Combine married/cohabiting</span>
  dplyr<span class="o">::</span>mutate<span class="p">(</span>u063_u066 <span class="o">=</span> u063 <span class="o">+</span> u066<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Combine married/cohabiting</span>
  dplyr<span class="o">::</span>mutate<span class="p">(</span>u064_u067 <span class="o">=</span> u064 <span class="o">+</span> u067<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Combine married/cohabiting</span>
  dplyr<span class="o">::</span>mutate<span class="p">(</span>u049_u050 <span class="o">=</span> u049 <span class="o">+</span> u050<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Combine english skills</span>
  dplyr<span class="o">::</span>mutate<span class="p">(</span>u127_u129 <span class="o">=</span> u127 <span class="o">+</span> u129<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Comnine students</span>
  dplyr<span class="o">::</span>mutate<span class="p">(</span>u095_u096 <span class="o">=</span> u095 <span class="o">+</span> u096<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># combine occupancy rating</span>
  dplyr<span class="o">::</span>select<span class="p">(</span><span class="o">-</span>u062<span class="o">:-</span>u067<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Remove married/cohabiting</span>
  dplyr<span class="o">::</span>select<span class="p">(</span><span class="o">-</span>u047<span class="o">:-</span>u050<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># Remove english skills</span>
  dplyr<span class="o">::</span>select<span class="p">(</span><span class="o">-</span>u127<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># remove students</span>
  dplyr<span class="o">::</span>select<span class="p">(</span><span class="o">-</span>u129<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># remove students</span>
  dplyr<span class="o">::</span>select<span class="p">(</span><span class="o">-</span>u095<span class="o">:-</span>u099<span class="p">)</span>  <span class="c1"># remove occupancy</span>

cv_pct_data <span class="o">&lt;-</span> cv_pct_data<span class="p">[,</span> <span class="kp">order</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cv_pct_data<span class="p">))]</span> <span class="c1"># sort colums by name # sort colums by name</span>

<span class="c1"># Make lookup maps</span>
keys <span class="o">&lt;-</span> <span class="kp">as.list</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span>variable_choices<span class="o">$</span>VariableCode<span class="p">,</span> 
                  <span class="kt">c</span><span class="p">(</span><span class="s">&quot;OA&quot;</span><span class="p">,</span> 
                    <span class="s">&quot;u062_u065&quot;</span><span class="p">,</span>
                    <span class="s">&quot;u063_u066&quot;</span><span class="p">,</span> 
                    <span class="s">&quot;u064_u067&quot;</span><span class="p">,</span>
                    <span class="s">&quot;u049_u050&quot;</span><span class="p">,</span>
                    <span class="s">&quot;u127_u129&quot;</span><span class="p">,</span>
                    <span class="s">&quot;u095_u096&quot;</span>
                    <span class="p">)))</span>

values <span class="o">&lt;-</span> <span class="kp">as.list</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span>variable_choices<span class="o">$</span>VariableLabel<span class="p">,</span> 
                    <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Output Area&quot;</span><span class="p">,</span> <span class="s">&quot;Married or cohabiting: No children&quot;</span><span class="p">,</span> 
                      <span class="s">&quot;Married or cohabiting: Dependent children&quot;</span><span class="p">,</span> 
                      <span class="s">&quot;Married or cohabiting: No dependent children&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Poor English Skils&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Student&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Crowded houseing&quot;</span>
                      <span class="p">)))</span>

lookup_map <span class="o">&lt;-</span> <span class="kp">list2env</span><span class="p">(</span>setNames<span class="p">(</span>values<span class="p">,</span> keys<span class="p">),</span> envir <span class="o">=</span> <span class="kp">new.env</span><span class="p">(</span>hash <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span>
rev_lookup_map <span class="o">&lt;-</span> <span class="kp">list2env</span><span class="p">(</span>setNames<span class="p">(</span>keys<span class="p">,</span> values<span class="p">),</span> envir <span class="o">=</span> <span class="kp">new.env</span><span class="p">(</span>hash <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span>
</pre></div>


<h4>Transformation</h4>
<p>Exploratory analysis of the data showed that there was a range of different distributions represented by the final variable choices. This was apparent through plotting histograms of each variable. A range of differing distributions creates a problem when using k-means as the algorithm is optimised to find spherical clusters and as such the optimal distribution for a successful k-means classification is the Gaussian distribution for input variables. In order to address this problem a transformation stage was performed. The transformation used was Inverse Hyperbolic Sine (IHS) which reduces the variance in variable distributions through increasing distance between small values and compressing distance between large values. An advantage of IHS is that unlike some other transformations it may also be used for zero or negative values.</p>
<div class="highlight"><pre><span></span><span class="c1"># Transformation (IHS)</span>
cv_ihs <span class="o">&lt;-</span> ihs<span class="p">(</span>cv_pct_data<span class="p">)</span>
</pre></div>


<h4>Standardisation</h4>
<p>In addition, the scale for the data was standardised. The method used in this work was the z-score which is a calculation of the number of standard deviations away from the variable mean a value is. Standardising the variable in this way is essential for effective k-means clustering as it prevents variables with larger scale ranges from being more influential and is standard practice when perfoming k-means.</p>
<div class="highlight"><pre><span></span><span class="c1"># Standardisation (Z-score)</span>
cv_ihs_z <span class="o">&lt;-</span> z_scores<span class="p">(</span>cv_ihs<span class="p">)</span>

<span class="c1"># rename variables to give full names</span>
<span class="kp">names</span><span class="p">(</span>cv_ihs_z<span class="p">)</span> <span class="o">&lt;-</span> purrr<span class="o">::</span>map_chr<span class="p">(</span><span class="kp">names</span><span class="p">(</span>cv_ihs_z<span class="p">),</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> lookup_map<span class="p">[[</span>x<span class="p">]])</span>
</pre></div>


<h4>Corrolation</h4>
<p>Reducing the number of variables for consumer vulnerability clustering from the initial selection was an iterative process. This was performed by investigating the correlation of variables after treatment of the data for clustering (section 2.3).  Highly correlated variables (Pearson coefficient &gt; 0.6) were considered for removal from the selection. However the final decision on whether a variable was kept or discarded was also based on interpretability of the final results rather than solely based on a coefficient cut-off.</p>
<div class="highlight"><pre><span></span><span class="c1"># Corrolation-------------------------------------------------------------------------</span>
cor_mat <span class="o">&lt;-</span> cor<span class="p">(</span>cv_ihs_z<span class="p">)</span>
high_cor <span class="o">&lt;-</span> purrr<span class="o">::</span>map<span class="p">(</span><span class="kp">colnames</span><span class="p">(</span>cor_mat<span class="p">),</span> cor_cutoff<span class="p">,</span> <span class="m">0.6</span><span class="p">)</span>
high_cor<span class="p">[</span>purrr<span class="o">::</span>map_lgl<span class="p">(</span>high_cor<span class="p">,</span> <span class="o">~</span><span class="kp">length</span><span class="p">(</span><span class="m">.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)]</span>
</pre></div>


<div class="highlight"><pre><span></span>## [[1]]
## Age 25 to 29      Retired 
##    1.0000000   -0.6009528 
## 
## [[2]]
## Age 60 to 64 Age 65 to 74      Retired 
##    1.0000000    0.6762770    0.7483487 
## 
## [[3]]
##                 Age 60 to 64                 Age 65 to 74 
##                    0.6762770                    1.0000000 
##                 Age 75 to 84 One person household: &gt;=  65 
##                    0.7133097                    0.7038382 
##                      Retired 
##                    0.9303259 
## 
## [[4]]
##                 Age 65 to 74                 Age 75 to 84 
##                    0.7133097                    1.0000000 
##                 Age 85 to 89 One person household: &gt;=  65 
##                    0.6354057                    0.7741075 
##                      Retired 
##                    0.7283789 
## 
## [[5]]
##                 Age 75 to 84                 Age 85 to 89 
##                    0.6354057                    1.0000000 
##                    Age &gt;= 90 One person household: &gt;=  65 
##                    0.6078266                    0.6151039 
## 
## [[6]]
## Age 85 to 89    Age &gt;= 90 
##    0.6078266    1.0000000 
## 
## [[7]]
##                 Age 65 to 74                 Age 75 to 84 
##                    0.7038382                    0.7741075 
##                 Age 85 to 89 One person household: &gt;=  65 
##                    0.6151039                    1.0000000 
##                      Retired 
##                    0.6898363 
## 
## [[8]]
## One person household: Other                       Flats 
##                   1.0000000                   0.6199775 
## 
## [[9]]
## Married or cohabiting: Dependent children 
##                                 1.0000000 
##                          Very good health 
##                                 0.6126617 
## 
## [[10]]
##   Whole house or bungalow: Detached                    Crowded houseing 
##                           1.0000000                           0.6224693 
##        No cars or vans in household 2 or more cars or vans in household 
##                          -0.7170235                           0.7199298 
## 
## [[11]]
##         One person household: Other                               Flats 
##                           0.6199775                           1.0000000 
##                    Crowded houseing 2 or more cars or vans in household 
##                          -0.6470808                          -0.6091593 
## 
## [[12]]
##          Owned and Shared Ownership                       Social rented 
##                           1.0000000                          -0.6408435 
##                    Crowded houseing        No cars or vans in household 
##                           0.7169065                          -0.6162756 
## 2 or more cars or vans in household 
##                           0.7515816 
## 
## [[13]]
##   Owned and Shared Ownership                Social rented 
##                   -0.6408435                    1.0000000 
## No cars or vans in household   Long-term sick or disabled 
##                    0.6378717                    0.6232023 
## 
## [[14]]
##   Whole house or bungalow: Detached                               Flats 
##                           0.6224693                          -0.6470808 
##          Owned and Shared Ownership                    Crowded houseing 
##                           0.7169065                           1.0000000 
##        No cars or vans in household 2 or more cars or vans in household 
##                          -0.6324442                           0.7583832 
## 
## [[15]]
## Day-to-day activities limited              Very good health 
##                     1.0000000                    -0.7366968 
##                   Fair health                    Bad health 
##                     0.8021976                     0.7570691 
##             No qualifications    Long-term sick or disabled 
##                     0.7671245                     0.6338326 
## 
## [[16]]
## Married or cohabiting: Dependent children 
##                                 0.6126617 
##             Day-to-day activities limited 
##                                -0.7366968 
##                          Very good health 
##                                 1.0000000 
##                               Fair health 
##                                -0.6484393 
## 
## [[17]]
## Day-to-day activities limited              Very good health 
##                     0.8021976                    -0.6484393 
##                   Fair health                    Bad health 
##                     1.0000000                     0.6383888 
##             No qualifications 
##                     0.7664267 
## 
## [[18]]
## Day-to-day activities limited                   Fair health 
##                     0.7570691                     0.6383888 
##                    Bad health             No qualifications 
##                     1.0000000                     0.7009737 
##    Long-term sick or disabled 
##                     0.6951246 
## 
## [[19]]
##     Day-to-day activities limited                       Fair health 
##                         0.7671245                         0.7664267 
##                        Bad health                 No qualifications 
##                         0.7009737                         1.0000000 
## Highest qualification: &gt;= Level 4        Long-term sick or disabled 
##                        -0.7631472                         0.6253844 
##          Professional occupations 
##                        -0.6740730 
## 
## [[20]]
##                        No qualifications 
##                               -0.7631472 
##        Highest qualification: &gt;= Level 4 
##                                1.0000000 
##               Long-term sick or disabled 
##                               -0.6066099 
## Managers, directors and senior officials 
##                                0.6315341 
##                 Professional occupations 
##                                0.8643247 
##     Associate professional and technical 
##                                0.6642001 
## 
## [[21]]
##   Whole house or bungalow: Detached          Owned and Shared Ownership 
##                          -0.7170235                          -0.6162756 
##                       Social rented                    Crowded houseing 
##                           0.6378717                          -0.6324442 
##        No cars or vans in household 2 or more cars or vans in household 
##                           1.0000000                          -0.7995621 
## 
## [[22]]
##   Whole house or bungalow: Detached                               Flats 
##                           0.7199298                          -0.6091593 
##          Owned and Shared Ownership                    Crowded houseing 
##                           0.7515816                           0.7583832 
##        No cars or vans in household 2 or more cars or vans in household 
##                          -0.7995621                           1.0000000 
## 
## [[23]]
##                            Self-employed 
##                                1.0000000 
## Managers, directors and senior officials 
##                                0.6226272 
## 
## [[24]]
##                 Age 25 to 29                 Age 60 to 64 
##                   -0.6009528                    0.7483487 
##                 Age 65 to 74                 Age 75 to 84 
##                    0.9303259                    0.7283789 
## One person household: &gt;=  65                      Retired 
##                    0.6898363                    1.0000000 
## 
## [[25]]
##                     Social rented     Day-to-day activities limited 
##                         0.6232023                         0.6338326 
##                        Bad health                 No qualifications 
##                         0.6951246                         0.6253844 
## Highest qualification: &gt;= Level 4        Long-term sick or disabled 
##                        -0.6066099                         1.0000000 
## 
## [[26]]
##        Highest qualification: &gt;= Level 4 
##                                0.6315341 
##                            Self-employed 
##                                0.6226272 
## Managers, directors and senior officials 
##                                1.0000000 
## 
## [[27]]
##                    No qualifications    Highest qualification: &gt;= Level 4 
##                           -0.6740730                            0.8643247 
##             Professional occupations Associate professional and technical 
##                            1.0000000                            0.6324629 
## 
## [[28]]
##    Highest qualification: &gt;= Level 4             Professional occupations 
##                            0.6642001                            0.6324629 
## Associate professional and technical 
##                            1.0000000
</pre></div>


<h3>Principal Component Analysis</h3>
<p>After selecting the variables for clustering and performing data transformation, there were still variables that were highly correlated which were kept as they increased the interpretability of the final clusters.  There were also a reasonably large number of variables remaining despite the original cluster choices being largely cut down. To help address these issues, principal component analysis (PCA) was performed on the treated dataset before clustering.</p>
<p>PCA is a dimensionality reduction technique which uses orthogonal transformation to convert potentially correlated variables into linearly uncorrelated principal components. It is frequently used alongside k-means  to lower the dimensionally of data while retaining as much variation as possible before clustering. This helps to avoid the "curse of dimensionality" sometimes experienced when clustering data. When PCA is performed before k-means the user must decide how many principal components will be used as input for the clustering step. This was achieved by looking at the variance explained by each principal component and the cumulative variance. An elbow plot was used to help to make this decision.</p>
<div class="highlight"><pre><span></span><span class="c1"># Perfom principle component analysis</span>
pca_obj <span class="o">&lt;-</span> stats<span class="o">::</span>princomp<span class="p">(</span>cv_ihs_z<span class="p">,</span> scores <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
</pre></div>


<p>We can look at variation each componet explains.</p>
<div class="highlight"><pre><span></span><span class="c1"># Look at variation each componet explains</span>
pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="kp">sum</span><span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>##       Comp.1       Comp.2       Comp.3       Comp.4       Comp.5 
## 0.1975901584 0.1670138959 0.0978362094 0.0459346094 0.0359967077 
##       Comp.6       Comp.7       Comp.8       Comp.9      Comp.10 
## 0.0311052455 0.0239476712 0.0202571869 0.0182858240 0.0179127696 
##      Comp.11      Comp.12      Comp.13      Comp.14      Comp.15 
## 0.0147648013 0.0144446687 0.0142151210 0.0134479015 0.0120634714 
##      Comp.16      Comp.17      Comp.18      Comp.19      Comp.20 
## 0.0118792615 0.0108562192 0.0106571552 0.0102412626 0.0098802908 
##      Comp.21      Comp.22      Comp.23      Comp.24      Comp.25 
## 0.0094481845 0.0092024290 0.0091019221 0.0089562946 0.0085281870 
##      Comp.26      Comp.27      Comp.28      Comp.29      Comp.30 
## 0.0080004497 0.0079004968 0.0078697059 0.0075594576 0.0072820050 
##      Comp.31      Comp.32      Comp.33      Comp.34      Comp.35 
## 0.0070081112 0.0068511666 0.0066095603 0.0065055815 0.0062275930 
##      Comp.36      Comp.37      Comp.38      Comp.39      Comp.40 
## 0.0061569703 0.0060947324 0.0059531902 0.0058181003 0.0055392923 
##      Comp.41      Comp.42      Comp.43      Comp.44      Comp.45 
## 0.0052262950 0.0051758398 0.0049676091 0.0047944031 0.0045788334 
##      Comp.46      Comp.47      Comp.48      Comp.49      Comp.50 
## 0.0045017607 0.0040835960 0.0040337823 0.0039130858 0.0035591423 
##      Comp.51      Comp.52      Comp.53      Comp.54      Comp.55 
## 0.0033986543 0.0033036418 0.0030551303 0.0029511841 0.0025320804 
##      Comp.56      Comp.57      Comp.58      Comp.59      Comp.60 
## 0.0024629900 0.0023318607 0.0021472566 0.0017952480 0.0017312859 
##      Comp.61      Comp.62      Comp.63      Comp.64 
## 0.0014692103 0.0012910101 0.0010081484 0.0007440902
</pre></div>


<div class="highlight"><pre><span></span>plot<span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="kp">sum</span><span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="p">),</span>
     <span class="c1">#main=&quot;Variance explained by priciple components&quot;,</span>
     xlab<span class="o">=</span><span class="s">&quot;Principal components&quot;</span><span class="p">,</span> 
     ylab<span class="o">=</span><span class="s">&quot;Variance&quot;</span><span class="p">,</span> 
     type <span class="o">=</span> <span class="s">&quot;o&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-8-1.png" /></p>
<p>We can also look at the cumulative variation.</p>
<div class="highlight"><pre><span></span><span class="c1"># Look at cumulative variation</span>
<span class="kp">cumsum</span><span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="kp">sum</span><span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>##    Comp.1    Comp.2    Comp.3    Comp.4    Comp.5    Comp.6    Comp.7 
## 0.1975902 0.3646041 0.4624403 0.5083749 0.5443716 0.5754768 0.5994245 
##    Comp.8    Comp.9   Comp.10   Comp.11   Comp.12   Comp.13   Comp.14 
## 0.6196817 0.6379675 0.6558803 0.6706451 0.6850897 0.6993049 0.7127528 
##   Comp.15   Comp.16   Comp.17   Comp.18   Comp.19   Comp.20   Comp.21 
## 0.7248162 0.7366955 0.7475517 0.7582089 0.7684501 0.7783304 0.7877786 
##   Comp.22   Comp.23   Comp.24   Comp.25   Comp.26   Comp.27   Comp.28 
## 0.7969810 0.8060830 0.8150393 0.8235674 0.8315679 0.8394684 0.8473381 
##   Comp.29   Comp.30   Comp.31   Comp.32   Comp.33   Comp.34   Comp.35 
## 0.8548976 0.8621796 0.8691877 0.8760388 0.8826484 0.8891540 0.8953816 
##   Comp.36   Comp.37   Comp.38   Comp.39   Comp.40   Comp.41   Comp.42 
## 0.9015385 0.9076333 0.9135865 0.9194046 0.9249439 0.9301702 0.9353460 
##   Comp.43   Comp.44   Comp.45   Comp.46   Comp.47   Comp.48   Comp.49 
## 0.9403136 0.9451080 0.9496868 0.9541886 0.9582722 0.9623060 0.9662191 
##   Comp.50   Comp.51   Comp.52   Comp.53   Comp.54   Comp.55   Comp.56 
## 0.9697782 0.9731769 0.9764805 0.9795356 0.9824868 0.9850189 0.9874819 
##   Comp.57   Comp.58   Comp.59   Comp.60   Comp.61   Comp.62   Comp.63 
## 0.9898138 0.9919610 0.9937563 0.9954875 0.9969568 0.9982478 0.9992559 
##   Comp.64 
## 1.0000000
</pre></div>


<div class="highlight"><pre><span></span>plot<span class="p">(</span><span class="kp">cumsum</span><span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="kp">sum</span><span class="p">(</span>pca_obj<span class="o">$</span>sdev<span class="o">^</span><span class="m">2</span><span class="p">)),</span> 
     <span class="c1">#main=&quot;Cumulative variance explained by priciple components&quot;,</span>
     xlab<span class="o">=</span><span class="s">&quot;Principal Components&quot;</span><span class="p">,</span> 
     ylab<span class="o">=</span><span class="s">&quot;Cumulative Variance&quot;</span><span class="p">,</span>
     type <span class="o">=</span> <span class="s">&quot;o&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-9-1.png" /></p>
<p>When IHS transformation is used the first 25 priciple explains 81% of variation</p>
<div class="highlight"><pre><span></span><span class="c1"># When IHS transformation is used the first 25 priciple explains 81% of variation</span>
num_pc <span class="o">&lt;-</span> <span class="m">10</span>
</pre></div>


<p>The principal component loadings were examined to fin how prepresent each variable was by the first 10 principal components. In order explore this the loadings for the first 10 principal components were summed. The lowest represented variable was for the household variable "Other: All aged 65 and over". To contrast with this, the age bands exceeding 65 were quite highly represented. Examining the correlation of "Other: All aged 65 and over" with these variables, the Pearson coefficient was 0.70 for "Age 65 to 70", 0.77 for "Age 75 to 84" and 0.62 for "Age 85 to 89". In addition there is a high correlation with the "Retired" variable at a Pearson coefficient of 0.69. These findings are not surprising but do help to explain the lower representation of the "Other: All aged 65 and over" variable and gives confidence that it is not a concern. Overall there is a good representation of all variables within the principal component loadings that were used for clustering input.</p>
<div class="highlight"><pre><span></span><span class="c1">#Loadings</span>
load <span class="o">&lt;-</span> <span class="kp">with</span><span class="p">(</span>pca_obj<span class="p">,</span> <span class="kp">unclass</span><span class="p">(</span>loadings<span class="p">))</span>
loadings <span class="o">&lt;-</span> <span class="kp">sweep</span><span class="p">(</span><span class="kp">abs</span><span class="p">(</span><span class="kp">load</span><span class="p">),</span> <span class="m">2</span><span class="p">,</span> <span class="kp">colSums</span><span class="p">(</span><span class="kp">abs</span><span class="p">(</span><span class="kp">load</span><span class="p">)),</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>

par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
barplot<span class="p">(</span><span class="kp">rowSums</span><span class="p">(</span><span class="kp">abs</span><span class="p">(</span><span class="kp">load</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span>num_pc<span class="p">])),</span> las<span class="o">=</span><span class="m">2</span><span class="p">,</span> cex.names <span class="o">=</span> <span class="m">0.6</span><span class="p">,</span> <span class="c1">#main = &quot;Sum of Loadings for Principal components 1 to 10&quot;, </span>
        ylab <span class="o">=</span> <span class="s">&quot;Sum of Principal Componet Loadings&quot;</span><span class="p">,</span> border <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-11-1.png" /></p>
<h3>K-means Clustering</h3>
<p>K-means is an iterative algorithm which finds clusters in data based on the centroids of clusters. Centroid position is random for initial step and subsequently updated at each iteration based on the previous cluster assignments . The initial cluster centroids are randomly selected and the number of clusters (k) must be chosen by the user. </p>
<p>K-means was performed using principal components generated from the PCA step as input. The optimum number of clusters was first determined by running k-means at each value of k from 2 to 25. Scree plots and smallest cluster plots from the results were then created. A scree or elbow plot shows the within cluster sum of squares for each cluster number when running k-means. The aim of such a plot is to show where the elbow is, suggesting an appropriate number of clusters, as there are diminishing returns after this point. A smallest cluster plot shows the size of the smallest cluster size when k-means is run for each number of clusters. This allows us to see at which point we start the get very small clusters, which is undesirable. </p>
<p>As the initialisation of centroids for k-means clustering was random, clustering was repeated for each value of k 25 times with different random centroid placement. From these 25 runs the result with the lowest total within sum of squares were chosen for the result.  Once an appropriate number of clusters was chosen, k-means was run again on the dataset 100 times at the selected number for k and the solution with the lowest within sum of squares was selected. </p>
<div class="highlight"><pre><span></span>iter <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">25</span>
k_choice_clust_list <span class="o">&lt;-</span> k_comparison<span class="p">(</span>pca_obj<span class="o">$</span>scores<span class="p">[,</span> <span class="m">1</span><span class="o">:</span>num_pc<span class="p">],</span> iter<span class="p">,</span> <span class="m">25</span><span class="p">)</span>
scree<span class="p">(</span>k_choice_clust_list<span class="p">,</span> iter<span class="p">,</span> <span class="s">&quot;All data&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-12-1.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-12-2.png" /></p>
<div class="highlight"><pre><span></span><span class="c1"># Small clusters start after a k of ? and elbow plot shows decreasing WSS at around ?</span>
num_clusters <span class="o">&lt;-</span> <span class="m">6</span>

nstart<span class="o">=</span><span class="m">100</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">2494</span><span class="p">)</span>
<span class="kp">system.time</span><span class="p">(</span>
  k_means_obj <span class="o">&lt;-</span> k_means<span class="p">(</span>num_clusters<span class="p">,</span> pca_obj<span class="o">$</span>scores<span class="p">[,</span> <span class="m">1</span><span class="o">:</span>num_pc<span class="p">],</span> nstart<span class="p">)</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>##    user  system elapsed 
## 856.426   0.000 860.510
</pre></div>


<div class="highlight"><pre><span></span>cluster_names <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Students and Young Professionals&quot;</span><span class="p">,</span> <span class="s">&quot;On a Budget&quot;</span><span class="p">,</span> <span class="s">&quot;Prosperous Professionals&quot;</span><span class="p">,</span>
                   <span class="s">&quot;Well Established&quot;</span><span class="p">,</span> <span class="s">&quot;Vulnerable Communities&quot;</span><span class="p">,</span> <span class="s">&quot;Vulnerable Pensioners&quot;</span><span class="p">)</span>
</pre></div>


<p>To aid interpretation we can view how each cluster realtes to each variable (rather than principal components)</p>
<div class="highlight"><pre><span></span><span class="c1"># Compute a data frame (one row per cluster) containing the means of each variable in that cluster</span>
cluster_zscores <span class="o">&lt;-</span> plyr<span class="o">::</span>ddply<span class="p">(</span>cv_ihs_z<span class="p">,</span> <span class="m">.</span><span class="p">(</span>k_means_obj<span class="o">$</span>cluster<span class="p">),</span> numcolwise<span class="p">(</span><span class="kp">mean</span><span class="p">))[,</span> <span class="m">-1</span><span class="p">]</span>
<span class="kp">row.names</span><span class="p">(</span>cluster_zscores<span class="p">)</span> <span class="o">&lt;-</span> cluster_names
</pre></div>


<h3>Sub-clusters</h3>
<p>In order to explore the clusters further, k-means clustering was applied to each cluster separately to create sub-clusters. For each cluster dataset the appropriate number for k was determined using the same method as when k-means was used on the whole data. To create the sub-clusters the k-means algorithm was run on each cluster data-set 100 times at the chosen number for k and the solution with the lowest within sum of squares was selected.</p>
<div class="highlight"><pre><span></span><span class="c1">### same steps for Sub groups</span>
cluster_selection <span class="o">&lt;-</span> tibble<span class="o">::</span>as_tibble<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>pca_obj<span class="o">$</span>scores<span class="p">[,</span> <span class="m">1</span><span class="o">:</span>num_pc<span class="p">],</span> cluster<span class="o">=</span>k_means_obj<span class="o">$</span>cluster<span class="p">,</span> OA<span class="o">=</span>oa_data<span class="o">$</span>OA<span class="p">))</span>
map<span class="p">(</span><span class="m">1</span><span class="o">:</span>num_clusters<span class="p">,</span> run_kmeans_comp_subgroup<span class="p">,</span> cluster_selection<span class="p">,</span> num_pc<span class="p">)</span>
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-1.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-2.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-3.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-4.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-5.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-6.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-7.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-8.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-9.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-10.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-11.png" /><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-15-12.png" /></p>
<div class="highlight"><pre><span></span>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]
## NULL
## 
## [[6]]
## NULL
</pre></div>


<p>Again aid interpretation in the sub-clusters we can view how each cluster realtes to each variable . The sub-group z-score are assesed both as is (global mean comparision) and in realtion to their parent group (difference in z-score). </p>
<div class="highlight"><pre><span></span>sub_k <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
sub_groups <span class="o">&lt;-</span> map<span class="p">(</span><span class="m">1</span><span class="o">:</span>num_clusters<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>subgroup<span class="p">,</span> data<span class="p">)</span> dplyr<span class="o">::</span>filter<span class="p">(</span>data<span class="p">,</span> cluster<span class="o">==</span>subgroup<span class="p">),</span> cluster_selection<span class="p">)</span>
sub_groups_kmeans <span class="o">&lt;-</span> purrr<span class="o">::</span>map2<span class="p">(</span>sub_groups<span class="p">,</span> sub_k<span class="p">,</span> run_kmeans_subgroup<span class="p">,</span> nstart<span class="p">)</span>
sub_cluster_zscores <span class="o">&lt;-</span> purrr<span class="o">::</span>map<span class="p">(</span><span class="m">1</span><span class="o">:</span>num_clusters<span class="p">,</span> avg_z<span class="p">,</span> sub_groups_kmeans<span class="p">,</span> k_means_obj<span class="p">,</span> cv_ihs_z<span class="p">)</span>
cluster_z_diff <span class="o">&lt;-</span> purrr<span class="o">::</span>map<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>sub_cluster_zscores<span class="p">),</span> 
                      <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> cluster_difference<span class="p">(</span>sub_cluster_zscores<span class="p">[[</span>x<span class="p">]],</span> cluster_zscores<span class="p">[</span>x<span class="p">,]))</span>
</pre></div>


<h3>Radial Plots</h3>
<h4>Groups</h4>
<p>Radial plots were produced for each cluster showing the z-scores for each variable. These show the strength of each characteristic in each cluster.</p>
<div class="highlight"><pre><span></span><span class="c1"># groups to global</span>
purrr<span class="o">::</span>map<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>cluster_zscores<span class="p">),</span> 
    <span class="kr">function</span><span class="p">(</span>cluster_z_diff<span class="p">,</span> x<span class="p">)</span> radial_plot<span class="p">(</span>cluster_zscores<span class="p">[</span>x<span class="p">,],</span> cluster_names<span class="p">[</span>x<span class="p">],</span> min_max<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">3</span><span class="p">),</span> <span class="s">&quot;Group to global \n mean z-score\n&quot;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals&quot; &quot;On a Budget&quot;                     
## [3] &quot;Prosperous Professionals&quot;         &quot;Well Established&quot;                
## [5] &quot;Vulnerable Communities&quot;           &quot;Vulnerable Pensioners&quot;
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals&quot; &quot;On a Budget&quot;                     
## [3] &quot;Prosperous Professionals&quot;         &quot;Well Established&quot;                
## [5] &quot;Vulnerable Communities&quot;           &quot;Vulnerable Pensioners&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-17-1.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals&quot; &quot;On a Budget&quot;                     
## [3] &quot;Prosperous Professionals&quot;         &quot;Well Established&quot;                
## [5] &quot;Vulnerable Communities&quot;           &quot;Vulnerable Pensioners&quot;
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals&quot; &quot;On a Budget&quot;                     
## [3] &quot;Prosperous Professionals&quot;         &quot;Well Established&quot;                
## [5] &quot;Vulnerable Communities&quot;           &quot;Vulnerable Pensioners&quot;
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals&quot; &quot;On a Budget&quot;                     
## [3] &quot;Prosperous Professionals&quot;         &quot;Well Established&quot;                
## [5] &quot;Vulnerable Communities&quot;           &quot;Vulnerable Pensioners&quot;
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals&quot; &quot;On a Budget&quot;                     
## [3] &quot;Prosperous Professionals&quot;         &quot;Well Established&quot;                
## [5] &quot;Vulnerable Communities&quot;           &quot;Vulnerable Pensioners&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-17-2.png" /></p>
<div class="highlight"><pre><span></span>## [[1]]
## [[1]]$xpd
## [1] TRUE
## 
## 
## [[2]]
## [[2]]$xpd
## [1] TRUE
## 
## 
## [[3]]
## [[3]]$xpd
## [1] TRUE
## 
## 
## [[4]]
## [[4]]$xpd
## [1] TRUE
## 
## 
## [[5]]
## [[5]]$xpd
## [1] TRUE
## 
## 
## [[6]]
## [[6]]$xpd
## [1] TRUE
</pre></div>


<h4>Sub-groups</h4>
<p>Radial plots were produced for each cluster showing the z-scores for each variable compared to the gloab mean (red) and to the parent group mean (blue).</p>
<div class="highlight"><pre><span></span><span class="c1"># sub to global and sub to group diff (red line is global, blue line is difference between group and subgroup)</span>
purrr<span class="o">::</span>pmap<span class="p">(</span><span class="kt">list</span><span class="p">(</span>sub_cluster_zscores<span class="p">,</span> cluster_z_diff<span class="p">,</span> cluster_names<span class="p">),</span> 
     <span class="kr">function</span><span class="p">(</span>global<span class="p">,</span> <span class="kp">diff</span><span class="p">,</span> name<span class="p">)</span> purrr<span class="o">::</span>map<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>global<span class="p">),</span> 
                           <span class="kr">function</span><span class="p">(</span>i<span class="p">,</span> global<span class="p">,</span> <span class="kp">diff</span><span class="p">,</span> name<span class="p">)</span> radial_plot<span class="p">(</span><span class="kp">rbind</span><span class="p">(</span>global<span class="p">[</span>i<span class="p">,],</span> <span class="kp">diff</span><span class="p">[</span>i<span class="p">,]),</span> <span class="kp">paste</span><span class="p">(</span>name<span class="p">,</span> <span class="s">&quot;- Sub-group&quot;</span><span class="p">,</span> i<span class="p">),</span> min_max<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-6</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Subgroup to global \n mean z-score\n&quot;</span><span class="p">,</span> <span class="s">&quot;Subgroup to group \n mean z-score\n&quot;</span><span class="p">)),</span>
                           global<span class="p">,</span> <span class="kp">diff</span><span class="p">,</span> name<span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals - Sub-group 1&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-1.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals - Sub-group 2&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-2.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals - Sub-group 3&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-3.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals - Sub-group 4&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-4.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;On a Budget - Sub-group 1&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-5.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;On a Budget - Sub-group 2&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-6.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;On a Budget - Sub-group 3&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-7.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;On a Budget - Sub-group 4&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-8.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;On a Budget - Sub-group 5&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-9.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Prosperous Professionals - Sub-group 1&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-10.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Prosperous Professionals - Sub-group 2&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-11.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Prosperous Professionals - Sub-group 3&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-12.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Prosperous Professionals - Sub-group 4&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-13.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Prosperous Professionals - Sub-group 5&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-14.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Well Established - Sub-group 1&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-15.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Well Established - Sub-group 2&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-16.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Well Established - Sub-group 3&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-17.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Well Established - Sub-group 4&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-18.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 1&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-19.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 2&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-20.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 3&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-21.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 4&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-22.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 5&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-23.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 6&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-24.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 7&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-25.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Sub-group 8&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-26.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Pensioners - Sub-group 1&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-27.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Pensioners - Sub-group 2&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-28.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Pensioners - Sub-group 3&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-29.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Pensioners - Sub-group 4&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-30.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Pensioners - Sub-group 5&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-18-31.png" /></p>
<div class="highlight"><pre><span></span>## [[1]]
## [[1]][[1]]
## [[1]][[1]]$xpd
## [1] TRUE
## 
## 
## [[1]][[2]]
## [[1]][[2]]$xpd
## [1] TRUE
## 
## 
## [[1]][[3]]
## [[1]][[3]]$xpd
## [1] TRUE
## 
## 
## [[1]][[4]]
## [[1]][[4]]$xpd
## [1] TRUE
## 
## 
## 
## [[2]]
## [[2]][[1]]
## [[2]][[1]]$xpd
## [1] TRUE
## 
## 
## [[2]][[2]]
## [[2]][[2]]$xpd
## [1] TRUE
## 
## 
## [[2]][[3]]
## [[2]][[3]]$xpd
## [1] TRUE
## 
## 
## [[2]][[4]]
## [[2]][[4]]$xpd
## [1] TRUE
## 
## 
## [[2]][[5]]
## [[2]][[5]]$xpd
## [1] TRUE
## 
## 
## 
## [[3]]
## [[3]][[1]]
## [[3]][[1]]$xpd
## [1] TRUE
## 
## 
## [[3]][[2]]
## [[3]][[2]]$xpd
## [1] TRUE
## 
## 
## [[3]][[3]]
## [[3]][[3]]$xpd
## [1] TRUE
## 
## 
## [[3]][[4]]
## [[3]][[4]]$xpd
## [1] TRUE
## 
## 
## [[3]][[5]]
## [[3]][[5]]$xpd
## [1] TRUE
## 
## 
## 
## [[4]]
## [[4]][[1]]
## [[4]][[1]]$xpd
## [1] TRUE
## 
## 
## [[4]][[2]]
## [[4]][[2]]$xpd
## [1] TRUE
## 
## 
## [[4]][[3]]
## [[4]][[3]]$xpd
## [1] TRUE
## 
## 
## [[4]][[4]]
## [[4]][[4]]$xpd
## [1] TRUE
## 
## 
## 
## [[5]]
## [[5]][[1]]
## [[5]][[1]]$xpd
## [1] TRUE
## 
## 
## [[5]][[2]]
## [[5]][[2]]$xpd
## [1] TRUE
## 
## 
## [[5]][[3]]
## [[5]][[3]]$xpd
## [1] TRUE
## 
## 
## [[5]][[4]]
## [[5]][[4]]$xpd
## [1] TRUE
## 
## 
## [[5]][[5]]
## [[5]][[5]]$xpd
## [1] TRUE
## 
## 
## [[5]][[6]]
## [[5]][[6]]$xpd
## [1] TRUE
## 
## 
## [[5]][[7]]
## [[5]][[7]]$xpd
## [1] TRUE
## 
## 
## [[5]][[8]]
## [[5]][[8]]$xpd
## [1] TRUE
## 
## 
## 
## [[6]]
## [[6]][[1]]
## [[6]][[1]]$xpd
## [1] TRUE
## 
## 
## [[6]][[2]]
## [[6]][[2]]$xpd
## [1] TRUE
## 
## 
## [[6]][[3]]
## [[6]][[3]]$xpd
## [1] TRUE
## 
## 
## [[6]][[4]]
## [[6]][[4]]$xpd
## [1] TRUE
## 
## 
## [[6]][[5]]
## [[6]][[5]]$xpd
## [1] TRUE
</pre></div>


<p>In addition we can view all subgroups from each parant group an one plot to compare subgroups to each other. These radial plots show the subgroup z-scores compared to the global mean.</p>
<div class="highlight"><pre><span></span><span class="c1"># all subgroups to global means</span>
purrr<span class="o">::</span>map<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>sub_cluster_zscores<span class="p">),</span> 
    <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> radial_plot<span class="p">(</span>sub_cluster_zscores<span class="p">[[</span>x<span class="p">]],</span> <span class="kp">paste</span><span class="p">(</span>cluster_names<span class="p">[</span>x<span class="p">],</span> <span class="s">&quot;- Subgroups&quot;</span><span class="p">),</span> min_max<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-6</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> purrr<span class="o">::</span>map<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>sub_cluster_zscores<span class="p">[[</span>x<span class="p">]]),</span> 
                                                                                                                   <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Subgroup&quot;</span><span class="p">,</span> x<span class="p">))))</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;Students and Young Professionals - Subgroups&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-19-1.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;On a Budget - Subgroups&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-19-2.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Prosperous Professionals - Subgroups&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-19-3.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Well Established - Subgroups&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-19-4.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Communities - Subgroups&quot;
</pre></div>


<p><img alt="center" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-19-5.png" /></p>
<div class="highlight"><pre><span></span>## [1] &quot;Vulnerable Pensioners - Subgroups&quot;
</pre></div>


<p><img alt="center" src="figures/consumer_vulnerability_notebook_final/unnamed-chunk-19-6.png" /></p>
<div class="highlight"><pre><span></span>## [[1]]
## [[1]]$xpd
## [1] TRUE
## 
## 
## [[2]]
## [[2]]$xpd
## [1] TRUE
## 
## 
## [[3]]
## [[3]]$xpd
## [1] TRUE
## 
## 
## [[4]]
## [[4]]$xpd
## [1] TRUE
## 
## 
## [[5]]
## [[5]]$xpd
## [1] TRUE
## 
## 
## [[6]]
## [[6]]$xpd
## [1] TRUE
</pre></div>


<h3>Group Heatmap</h3>
<p>A heatmap was produced showing the z-scores for each variable in each cluster in a single figure. The dendogram produced with the heatmap by hierarchical clustering of the six clusters grouped "Vulnerable Pensioners" and "Vulnerable Communities" with similarities in education, vehicle ownership, and employment and housing variables. The "Well Established", "Prosperous Professional" and "On a Budget" clusters were also grouped together with similarities in housing, vehicle and living arrangement variables. The "Students and Young Professionals" were not very strongly grouped with any other clusters but closer to "Well Established", "Prosperous Professional" and "On a Budget" clusters than "Vulnerable Pensioners" and "Vulnerable Communities".</p>
<div class="highlight"><pre><span></span><span class="c1"># groups heatmap </span>
sub_cluster_zscores <span class="o">&lt;-</span> map2<span class="p">(</span>sub_cluster_zscores<span class="p">,</span> cluster_names<span class="p">,</span> rename_rows<span class="p">)</span>
<span class="c1">#pdf(&quot;figures\\group_heatmap.pdf&quot;, width = 250, height=350)</span>
create_heatmap<span class="p">(</span>cluster_zscores<span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">16</span><span class="p">,</span><span class="m">7</span><span class="p">))</span>
</pre></div>


<p><img alt="center" src="{/figures/consumer_vulnerability_notebook_final/unnamed-chunk-20-1.png" /></p>
<h3>Sub-group Heatmap</h3>
<p>To further explore the character of the clusters, k-means was run on each cluster to produce sub-clusters. The number of sub-clusters chosen for each cluster were 5 sub-clusters for "Prosperous Professionals", 4 for "Well-Established", 4 for "Students ans Young Professionals", 5 for "On a Budget", 8 for "Vulnerable Communities" and 5 for "Vulnerable Pensioners". These sub-clusters were then displayed using a heatmap  complete with dendogram showing the clustering of sub-clusters using hierarchical clustering with Euclidean distance. The hierarchical clustering revealed that many of the sub groups from the same parent group clustered together as in the case of  the "Students and Young Professionals" sub-groups which all clusters together. However some subgroups from different parents groups clustered more closely with each other than with other subgroups from their own parents group. An example of this is "Vulnerable Pensioners: Sub-group 5", "Well Established: Subgroup 3" and "On a Budget: Subgroup 3" which clustered together with similarities in age structure and population employment domains. </p>
<div class="highlight"><pre><span></span><span class="c1"># subgroups heatmap</span>
create_heatmap<span class="p">(</span><span class="kp">rbind</span><span class="p">(</span>sub_cluster_zscores<span class="p">[[</span><span class="m">1</span><span class="p">]],</span> sub_cluster_zscores<span class="p">[[</span><span class="m">2</span><span class="p">]],</span> sub_cluster_zscores<span class="p">[[</span><span class="m">3</span><span class="p">]],</span> sub_cluster_zscores<span class="p">[[</span><span class="m">4</span><span class="p">]],</span> sub_cluster_zscores<span class="p">[[</span><span class="m">5</span><span class="p">]],</span> sub_cluster_zscores<span class="p">[[</span><span class="m">6</span><span class="p">]])</span>
               <span class="p">,</span> <span class="m">31</span><span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="m">7</span><span class="p">))</span>
</pre></div>


<p><img alt="fig" src="https://michael-adcock.github.io/figures/consumer_vulnerability_notebook_final/unnamed-chunk-21-1.png" /></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://michael-adcock.github.io/tag/r.html">R</a>
      <a href="https://michael-adcock.github.io/tag/k-means.html">k-means</a>
      <a href="https://michael-adcock.github.io/tag/principal-component-analysis.html">principal component analysis</a>
      <a href="https://michael-adcock.github.io/tag/pca.html">PCA</a>
      <a href="https://michael-adcock.github.io/tag/census.html">census</a>
      <a href="https://michael-adcock.github.io/tag/consumer-vulnerability.html">consumer vulnerability</a>
    </p>
  </div>




</article>

    <footer>
<p>&copy; Michael Adcock </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Michael Adcock ",
  "url" : "https://michael-adcock.github.io",
  "image": "",
  "description": ""
}
</script>
</body>
</html>